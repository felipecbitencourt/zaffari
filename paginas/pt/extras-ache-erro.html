<!-- Extras - Ache o Erro -->
<div class="content-header">
    <h1>üîç Ache o Erro</h1>
</div>

<div class="content-body">
    <!-- INICIO DO TEXTO EDIT√ÅVEL -->
    <p class="lead">Analise os e-mails fict√≠cios do SAC e identifique os erros clicando diretamente nas frases
        incorretas.</p>

    <div class="ache-erro-game" id="ache-erro-game">
        <!-- Seletor de E-mails -->
        <div class="email-selector">
            <button class="email-tab active" data-email="0">üìß E-mail 1</button>
            <button class="email-tab" data-email="1">üìß E-mail 2</button>
            <button class="email-tab" data-email="2">üìß E-mail 3</button>
            <button class="email-tab" data-email="3">üìß E-mail 4</button>
        </div>

        <!-- Status do Jogo -->
        <div class="game-status">
            <div class="game-stars" id="game-stars">
                <span class="star">‚≠ê</span>
                <span class="star">‚≠ê</span>
                <span class="star">‚≠ê</span>
            </div>
            <div class="game-progress-text">
                Erros encontrados: <span id="erros-encontrados">0</span>/<span id="erros-total">3</span>
            </div>
        </div>

        <!-- Container do E-mail -->
        <div class="email-container" id="email-container">
            <div class="email-header-bar">
                <span class="email-icon">üìß</span>
                <span class="email-title">Caixa de Entrada</span>
            </div>
            <div class="email-meta">
                <div class="email-field"><strong>De:</strong> <span id="email-de">sac@empresa.com.br</span></div>
                <div class="email-field"><strong>Para:</strong> <span id="email-para">cliente@email.com</span></div>
                <div class="email-field"><strong>Assunto:</strong> <span id="email-assunto">Re: Solicita√ß√£o</span>
                </div>
            </div>
            <div class="email-divider"></div>
            <div class="email-body" id="email-body">
                <!-- Conte√∫do do e-mail ser√° injetado via JS -->
            </div>
        </div>

        <!-- Feedback dos Erros Encontrados -->
        <div class="erros-feedback" id="erros-feedback">
            <h4>‚úÖ Erros Identificados:</h4>
            <div class="erros-list" id="erros-list">
                <!-- Erros encontrados aparecem aqui -->
            </div>
        </div>

        <!-- Mensagem de Conclus√£o -->
        <div class="email-completo" id="email-completo" style="display: none;">
            <div class="email-completo-content">
                <span class="email-completo-icon">üéâ</span>
                <h3>Parab√©ns!</h3>
                <p>Voc√™ encontrou todos os erros deste e-mail!</p>
                <button class="btn-proximo-email" id="btn-proximo-email">Pr√≥ximo E-mail ‚Üí</button>
            </div>
        </div>

        <!-- Resumo Final -->
        <div class="resumo-final" id="resumo-final" style="display: none;">
            <div class="resumo-final-content">
                <span class="resumo-icon">üèÜ</span>
                <h3>Jogo Conclu√≠do!</h3>
                <p>Voc√™ completou todos os e-mails!</p>
                <div class="resumo-estrelas" id="resumo-estrelas"></div>
                <button class="btn-reiniciar" id="btn-reiniciar">üîÑ Jogar Novamente</button>
            </div>
        </div>
    </div>

    <!-- Bot√£o Voltar -->
    <div class="extras-back-container" style="margin-top: var(--spacing-xl); text-align: center;">
        <button class="btn-extras-back" onclick="navigateToPage('extras-hub')">‚Üê Voltar ao Menu de Extras</button>
    </div>
    <!-- FIM DO TEXTO EDIT√ÅVEL -->
</div>

<script>
    function initAcheErro() {
        // Dados dos E-mails
        const emailsData = [
            {
                de: "sac@zaffari.com.br",
                para: "joao.silva@email.com",
                assunto: "Re: Solicita√ß√£o de troca #12345",
                corpo: `Prezado Jo√£o,

Agradecemos seu contato. Sobre sua solicita√ß√£o de troca do produto adquirido em nossa loja f√≠sica, informamos que <span class="erro" data-erro="1">voc√™ tem direito garantido por lei √† troca</span> em at√© <span class="erro" data-erro="2">7 dias √∫teis</span>.

Por favor, <span class="erro" data-erro="3">envie o produto para nossa assist√™ncia t√©cnica</span> para darmos andamento.

Atenciosamente,
Equipe SAC`,
                erros: {
                    1: {
                        texto: "voc√™ tem direito garantido por lei √† troca",
                        explicacao: "A troca de produto SEM DEFEITO em loja f√≠sica √© uma POL√çTICA COMERCIAL (cortesia da empresa), n√£o um direito garantido por lei. O CDC s√≥ obriga troca em caso de defeito."
                    },
                    2: {
                        texto: "7 dias √∫teis",
                        explicacao: "Quando aplic√°vel (compras online), o prazo do Direito de Arrependimento √© de 7 dias CORRIDOS, n√£o √∫teis."
                    },
                    3: {
                        texto: "envie o produto para nossa assist√™ncia t√©cnica",
                        explicacao: "Produto SEM DEFEITO n√£o deve ser encaminhado para assist√™ncia t√©cnica. A assist√™ncia t√©cnica √© para reparos de produtos COM DEFEITO."
                    }
                }
            },
            {
                de: "sac@zaffari.com.br",
                para: "maria.santos@email.com",
                assunto: "Re: Desist√™ncia de compra #67890",
                corpo: `Prezada Maria,

Recebemos sua solicita√ß√£o de desist√™ncia da compra realizada em nossa loja f√≠sica na √∫ltima semana.

Informamos que <span class="erro" data-erro="1">voc√™ pode exercer o direito de arrependimento</span> normalmente. Ao devolver o produto, <span class="erro" data-erro="2">devolveremos 80% do valor pago</span>.

Lembramos que <span class="erro" data-erro="3">ap√≥s a devolu√ß√£o, n√£o haver√° mais possibilidade de reclama√ß√£o sobre o produto</span>.

Atenciosamente,
Equipe SAC`,
                erros: {
                    1: {
                        texto: "voc√™ pode exercer o direito de arrependimento",
                        explicacao: "O Direito de Arrependimento (7 dias) s√≥ se aplica a compras ONLINE ou realizadas fora do estabelecimento comercial. N√ÉO se aplica a compras em loja f√≠sica."
                    },
                    2: {
                        texto: "devolveremos 80% do valor pago",
                        explicacao: "Quando o arrependimento √© aplic√°vel, a devolu√ß√£o do valor deve ser INTEGRAL (100%), incluindo frete. Nunca parcial."
                    },
                    3: {
                        texto: "ap√≥s a devolu√ß√£o, n√£o haver√° mais possibilidade de reclama√ß√£o sobre o produto",
                        explicacao: "O cliente sempre mant√©m o direito de reclamar de V√çCIOS OCULTOS (defeitos que aparecem depois), mesmo ap√≥s devolu√ß√µes ou trocas anteriores."
                    }
                }
            },
            {
                de: "sac@zaffari.com.br",
                para: "carlos.oliveira@email.com",
                assunto: "Re: Defeito em eletrodom√©stico #11223",
                corpo: `Prezado Carlos,

Lamentamos o inconveniente com seu eletrodom√©stico. Conforme o C√≥digo de Defesa do Consumidor, <span class="erro" data-erro="1">voc√™ tem at√© 15 dias para resolver o problema atrav√©s da assist√™ncia t√©cnica</span>.

Caso o problema n√£o seja solucionado neste prazo, <span class="erro" data-erro="2">faremos apenas o abatimento proporcional no valor</span>.

Por favor, dirija-se √† assist√™ncia t√©cnica autorizada da marca para avalia√ß√£o.

Atenciosamente,
Equipe SAC`,
                erros: {
                    1: {
                        texto: "voc√™ tem at√© 15 dias para resolver o problema atrav√©s da assist√™ncia t√©cnica",
                        explicacao: "O prazo correto √© de 30 DIAS para o fornecedor solucionar o defeito via assist√™ncia t√©cnica, n√£o 15 dias."
                    },
                    2: {
                        texto: "faremos apenas o abatimento proporcional no valor",
                        explicacao: "Ap√≥s os 30 dias sem solu√ß√£o, o cliente tem TR√äS op√ß√µes: troca do produto, abatimento proporcional OU devolu√ß√£o integral do valor. N√£o apenas uma op√ß√£o."
                    }
                }
            },
            {
                de: "sac@zaffari.com.br",
                para: "ana.costa@email.com",
                assunto: "Re: Troca de alimento #44556",
                corpo: `Prezada Ana,

Sobre sua solicita√ß√£o de troca do produto aliment√≠cio, informamos que <span class="erro" data-erro="1">voc√™ pode devolver o produto a qualquer loja da nossa rede</span>.

Para agilizar o processo, <span class="erro" data-erro="2">n√£o √© necess√°rio trazer o cupom fiscal</span>. Basta trazer o produto.

Ap√≥s an√°lise, <span class="erro" data-erro="3">trocaremos por qualquer produto de sua escolha no mesmo valor</span>.

Atenciosamente,
Equipe SAC`,
                erros: {
                    1: {
                        texto: "voc√™ pode devolver o produto a qualquer loja da nossa rede",
                        explicacao: "Produtos aliment√≠cios devem ser levados √† LOJA ONDE FOI REALIZADA A COMPRA, junto com o cupom fiscal, para avalia√ß√£o da ger√™ncia."
                    },
                    2: {
                        texto: "n√£o √© necess√°rio trazer o cupom fiscal",
                        explicacao: "O CUPOM FISCAL √â OBRIGAT√ìRIO para validar a compra e proceder com qualquer reclama√ß√£o ou troca de produtos."
                    },
                    3: {
                        texto: "trocaremos por qualquer produto de sua escolha no mesmo valor",
                        explicacao: "A troca de aliment√≠cios s√≥ ocorre quando o produto est√° IMPR√ìPRIO PARA CONSUMO, n√£o por prefer√™ncia do cliente. √â necess√°rio avaliar motivo, marca e lote."
                    }
                }
            }
        ];

        // Estado do jogo
        let currentEmail = 0;
        let errosEncontrados = [];
        let cliquesErrados = 0;
        let estrelasTotal = [];

        // Elementos DOM
        const emailContainer = document.getElementById('email-container');
        const emailBody = document.getElementById('email-body');
        const emailDe = document.getElementById('email-de');
        const emailPara = document.getElementById('email-para');
        const emailAssunto = document.getElementById('email-assunto');
        const errosEncontradosEl = document.getElementById('erros-encontrados');
        const errosTotalEl = document.getElementById('erros-total');
        const errosList = document.getElementById('erros-list');
        const errosFeedback = document.getElementById('erros-feedback');
        const emailCompleto = document.getElementById('email-completo');
        const resumoFinal = document.getElementById('resumo-final');
        const gameStars = document.getElementById('game-stars');
        const emailTabs = document.querySelectorAll('.email-tab');

        // Carregar e-mail
        function loadEmail(index) {
            const email = emailsData[index];
            currentEmail = index;
            errosEncontrados = [];
            cliquesErrados = 0;

            // Atualizar header
            emailDe.textContent = email.de;
            emailPara.textContent = email.para;
            emailAssunto.textContent = email.assunto;

            // Atualizar corpo (converter quebras de linha)
            emailBody.innerHTML = email.corpo.replace(/\n/g, '<br>');

            // Atualizar contadores
            const totalErros = Object.keys(email.erros).length;
            errosEncontradosEl.textContent = '0';
            errosTotalEl.textContent = totalErros;

            // Limpar feedback
            errosList.innerHTML = '';
            errosFeedback.style.display = 'none';
            emailCompleto.style.display = 'none';

            // Reset estrelas
            updateStars(3);

            // Atualizar tabs
            emailTabs.forEach((tab, i) => {
                tab.classList.toggle('active', i === index);
                if (estrelasTotal[i] !== undefined) {
                    tab.classList.add('completed');
                }
            });

            // Bind eventos nos erros
            bindErroEvents();
        }

        // Bind eventos de clique nos erros
        function bindErroEvents() {
            const erroElements = emailBody.querySelectorAll('.erro');
            erroElements.forEach(el => {
                el.addEventListener('click', handleErroClick);
            });

            // Clique em √°rea normal (n√£o erro)
            emailBody.addEventListener('click', function (e) {
                if (!e.target.classList.contains('erro') && !e.target.closest('.erro')) {
                    handleWrongClick();
                }
            });
        }

        // Clique em erro correto
        function handleErroClick(e) {
            e.stopPropagation();
            const el = e.target;
            const erroId = el.dataset.erro;
            const email = emailsData[currentEmail];

            if (el.classList.contains('found')) return;

            // Marcar como encontrado
            el.classList.add('found');
            errosEncontrados.push(erroId);

            // Atualizar contador
            errosEncontradosEl.textContent = errosEncontrados.length;

            // Mostrar explica√ß√£o
            const erroInfo = email.erros[erroId];
            const feedbackItem = document.createElement('div');
            feedbackItem.className = 'erro-feedback-item';
            feedbackItem.innerHTML = `
                <div class="erro-texto">"${erroInfo.texto}"</div>
                <div class="erro-explicacao">${erroInfo.explicacao}</div>
            `;
            errosList.appendChild(feedbackItem);
            errosFeedback.style.display = 'block';

            // Som de sucesso
            if (typeof AudioManager !== 'undefined') AudioManager.playSuccess();

            // Verificar se completou
            const totalErros = Object.keys(email.erros).length;
            if (errosEncontrados.length === totalErros) {
                completeEmail();
            }
        }

        // Clique errado
        function handleWrongClick() {
            cliquesErrados++;
            updateStars(calcStars());

            // Feedback visual
            emailContainer.classList.add('shake');
            setTimeout(() => emailContainer.classList.remove('shake'), 500);

            // Som de erro
            if (typeof AudioManager !== 'undefined') AudioManager.playError();
        }

        // Calcular estrelas
        function calcStars() {
            if (cliquesErrados === 0) return 3;
            if (cliquesErrados <= 2) return 2;
            return 1;
        }

        // Atualizar estrelas visuais
        function updateStars(count) {
            const stars = gameStars.querySelectorAll('.star');
            stars.forEach((star, i) => {
                star.classList.toggle('active', i < count);
                star.classList.toggle('inactive', i >= count);
            });
        }

        // E-mail completo
        function completeEmail() {
            estrelasTotal[currentEmail] = calcStars();

            // Atualizar tab visualmente
            emailTabs[currentEmail].classList.add('completed');
            emailTabs[currentEmail].innerHTML = `üìß E-mail ${currentEmail + 1} ${'‚≠ê'.repeat(estrelasTotal[currentEmail])}`;

            // Disparar confete
            createConfetti();

            // Aguardar para mostrar o popup, permitindo ler a explica√ß√£o
            setTimeout(() => {
                emailCompleto.style.display = 'flex';
            }, 3000);

            // Verificar se todos completos
            if (estrelasTotal.filter(s => s !== undefined).length === emailsData.length) {
                document.getElementById('btn-proximo-email').textContent = 'Ver Resumo Final';
            }
        }

        // Fun√ß√£o simples de confete
        function createConfetti() {
            const colors = ['#D32F2F', '#FFC107', '#2196F3', '#4CAF50'];
            for (let i = 0; i < 50; i++) {
                const confetto = document.createElement('div');
                confetto.classList.add('confetti');
                confetto.style.left = Math.random() * 100 + 'vw';
                confetto.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetto.style.animationDuration = (Math.random() * 2 + 2) + 's';
                document.body.appendChild(confetto);

                // Remover ap√≥s anima√ß√£o
                setTimeout(() => confetto.remove(), 4000);
            }
        }

        // Pr√≥ximo e-mail
        document.getElementById('btn-proximo-email').addEventListener('click', function () {
            if (estrelasTotal.filter(s => s !== undefined).length === emailsData.length) {
                showResumo();
            } else {
                const nextEmail = (currentEmail + 1) % emailsData.length;
                loadEmail(nextEmail);
            }
        });

        // Mostrar resumo final
        function showResumo() {
            emailCompleto.style.display = 'none';
            resumoFinal.style.display = 'flex';

            const totalEstrelas = estrelasTotal.reduce((a, b) => a + b, 0);
            const maxEstrelas = emailsData.length * 3;

            document.getElementById('resumo-estrelas').innerHTML = `
                <p>Total: ${totalEstrelas}/${maxEstrelas} estrelas</p>
                <div class="estrelas-grandes">${'‚≠ê'.repeat(Math.round(totalEstrelas / emailsData.length))}</div>
            `;
        }

        // Reiniciar
        document.getElementById('btn-reiniciar').addEventListener('click', function () {
            estrelasTotal = [];
            resumoFinal.style.display = 'none';
            emailTabs.forEach((tab, i) => {
                tab.classList.remove('completed');
                tab.innerHTML = `üìß E-mail ${i + 1}`;
            });
            loadEmail(0);
        });

        // Tabs de e-mail
        emailTabs.forEach((tab, i) => {
            tab.addEventListener('click', function () {
                loadEmail(i);
            });
        });

        // Iniciar
        loadEmail(0);
    }

    // Inicializar ap√≥s pequeno delay
    setTimeout(initAcheErro, 50);
</script>