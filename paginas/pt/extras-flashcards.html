<!-- Extras - Flash Cards Interativos -->
<div class="content-header">
    <h1 data-i18n="extras.flashcards.title">üÉè Flash Cards</h1>
</div>

<div class="content-body">
    <!-- INICIO DO TEXTO EDIT√ÅVEL -->
    <p class="lead" data-i18n="extras.flashcards.lead">Memorize os conceitos do curso com cart√µes de estudo interativos.
        Clique no cart√£o para revelar a
        resposta!</p>

    <!-- Seletor de M√≥dulos com estado de unlock -->
    <div class="flashcard-modules-grid" id="flashcard-modules-container">
        <!-- M√≥dulo 1 -->
        <div class="flashcard-module-card" data-module="1" id="fc-module-m1">
            <div class="fc-module-header">
                <span class="fc-module-icon">üéØ</span>
                <h3 data-i18n="extras.flashcards.modules.m1.title">M√≥dulo 1: Papel Estrat√©gico</h3>
            </div>
            <p class="fc-module-desc" data-i18n="extras.flashcards.modules.m1.desc">Papel Estrat√©gico do SAC</p>
            <div class="fc-module-status">
                <span class="fc-status locked-status" data-i18n="extras.flashcards.modules.m1.lock_msg">üîí Conclua o
                    m√≥dulo</span>
                <span class="fc-status unlocked-status" style="display:none;"
                    data-i18n="extras.flashcards.modules.m1.unlock_msg">‚úì Dispon√≠vel</span>
                <span class="fc-card-count" data-i18n="extras.flashcards.modules.m1.count">8 cards</span>
            </div>
            <div class="fc-module-overlay">
                <span class="lock-icon">üîí</span>
            </div>
        </div>

        <!-- M√≥dulo 2 -->
        <div class="flashcard-module-card" data-module="2" id="fc-module-m2">
            <div class="fc-module-header">
                <span class="fc-module-icon">üîß</span>
                <h3 data-i18n="extras.flashcards.modules.m2.title">M√≥dulo 2: Onde encontrar informa√ß√µes</h3>
            </div>
            <p class="fc-module-desc" data-i18n="extras.flashcards.modules.m2.desc">Onde encontrar informa√ß√µes?</p>
            <div class="fc-module-status">
                <span class="fc-status locked-status" data-i18n="extras.flashcards.modules.m2.lock_msg">üîí Conclua o
                    m√≥dulo</span>
                <span class="fc-status unlocked-status" style="display:none;"
                    data-i18n="extras.flashcards.modules.m2.unlock_msg">‚úì Dispon√≠vel</span>
                <span class="fc-card-count" data-i18n="extras.flashcards.modules.m2.count">6 cards</span>
            </div>
            <div class="fc-module-overlay">
                <span class="lock-icon">üîí</span>
            </div>
        </div>

        <!-- M√≥dulo 3 -->
        <div class="flashcard-module-card" data-module="3" id="fc-module-m3">
            <div class="fc-module-header">
                <span class="fc-module-icon">‚öñÔ∏è</span>
                <h3 data-i18n="extras.flashcards.modules.m3.title">M√≥dulo 3: CDC e Legisla√ß√£o</h3>
            </div>
            <p class="fc-module-desc" data-i18n="extras.flashcards.modules.m3.desc">CDC e Legisla√ß√£o</p>
            <div class="fc-module-status">
                <span class="fc-status locked-status" data-i18n="extras.flashcards.modules.m3.lock_msg">üîí Conclua o
                    m√≥dulo</span>
                <span class="fc-status unlocked-status" style="display:none;"
                    data-i18n="extras.flashcards.modules.m3.unlock_msg">‚úì Dispon√≠vel</span>
                <span class="fc-card-count" data-i18n="extras.flashcards.modules.m3.count">10 cards</span>
            </div>
            <div class="fc-module-overlay">
                <span class="lock-icon">üîí</span>
            </div>
        </div>
    </div>

    <!-- √Årea de Flashcards (inicialmente oculta at√© selecionar m√≥dulo) -->
    <div id="flashcard-play-area" style="display: none;">
        <!-- Header com deck selecionado -->
        <div class="flashcard-deck-header">
            <button class="btn-back-to-modules" id="fc-back-btn" data-i18n="extras.flashcards.ui.back_to_modules">‚Üê
                Voltar aos M√≥dulos</button>
            <span class="flashcard-deck-name" id="fc-deck-name">M√≥dulo 1</span>
        </div>

        <!-- Contador de Progresso -->
        <div class="flashcard-progress">
            <span class="flashcard-counter" data-i18n="[html]extras.flashcards.ui.card_counter">Card <span
                    id="fc-current">1</span> de <span id="fc-total">8</span></span>
            <div class="flashcard-progress-bar">
                <div class="flashcard-progress-fill" id="fc-progress" style="width: 5%;"></div>
            </div>
        </div>

        <!-- Container do Flashcard -->
        <div class="flashcard-container">
            <div class="flashcard" id="flashcard-active">
                <div class="flashcard-inner">
                    <div class="flashcard-front">
                        <span class="flashcard-deck-tag" id="fc-deck-tag">M√≥dulo 1</span>
                        <p class="flashcard-question" id="fc-question">Carregando...</p>
                        <span class="flashcard-hint" data-i18n="extras.flashcards.ui.hint_front">üëÜ Clique para ver a
                            resposta</span>
                    </div>
                    <div class="flashcard-back">
                        <span class="flashcard-deck-tag" id="fc-deck-tag-back">M√≥dulo 1</span>
                        <p class="flashcard-answer" id="fc-answer">Carregando...</p>
                        <span class="flashcard-hint" data-i18n="extras.flashcards.ui.hint_back">üëÜ Clique para
                            voltar</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Controles de Navega√ß√£o -->
        <div class="flashcard-controls">
            <button class="flashcard-nav-btn" id="fc-prev" disabled data-i18n="extras.flashcards.ui.prev">‚Üê
                Anterior</button>
            <button class="flashcard-shuffle-btn" id="fc-shuffle" data-i18n="extras.flashcards.ui.shuffle">üîÄ
                Embaralhar</button>
            <button class="flashcard-nav-btn" id="fc-next" data-i18n="extras.flashcards.ui.next">Pr√≥ximo ‚Üí</button>
        </div>
    </div>

    <div class="box-attention" style="margin-top: var(--spacing-xl);">
        <p data-i18n="[html]extras.flashcards.ui.tip">üí° <strong>Dica:</strong> Revise os flash cards regularmente para
            fixar o conhecimento. A t√©cnica de
            repeti√ß√£o espa√ßada √© uma das mais eficazes para memoriza√ß√£o!</p>
    </div>

    <!-- Bot√£o Voltar -->
    <div class="extras-back-container" style="margin-top: var(--spacing-xl); text-align: center;">
        <button class="btn-extras-back" onclick="navigateToPage('extras-hub')"
            data-i18n="extras.flashcards.ui.back_menu">‚Üê Voltar ao Menu de Extras</button>
    </div>
    <!-- FIM DO TEXTO EDIT√ÅVEL -->
</div>

<script>
    // Aguardar DOM carregar
    function initFlashcards() {
        // Dados dos Flash Cards - Carregados via I18n (sistema customizado)
        let flashcardsData = { m1: [], m2: [], m3: [] };

        // Usar o sistema I18n customizado do projeto
        if (typeof I18n !== 'undefined' && I18n.translations && I18n.translations.extras && I18n.translations.extras.flashcards) {
            const modules = I18n.translations.extras.flashcards.modules;
            console.log('[Flashcards] Found I18n.translations, modules:', modules);

            if (modules) {
                ['m1', 'm2', 'm3'].forEach(key => {
                    if (modules[key] && modules[key].cards) {
                        flashcardsData[key] = Object.values(modules[key].cards);
                        console.log('[Flashcards] Loaded ' + key + ':', flashcardsData[key].length + ' cards');
                    }
                });
            }
        } else {
            console.error('[Flashcards] I18n.translations not available yet');
        }

        console.log('[Flashcards] Final loaded data:', flashcardsData);

        // Nomes dos decks
        const deckNames = {
            m1: (typeof I18n !== 'undefined' && I18n.t) ? I18n.t('extras.flashcards.modules.m1.title') : 'M√≥dulo 1',
            m2: (typeof I18n !== 'undefined' && I18n.t) ? I18n.t('extras.flashcards.modules.m2.title') : 'M√≥dulo 2',
            m3: (typeof I18n !== 'undefined' && I18n.t) ? I18n.t('extras.flashcards.modules.m3.title') : 'M√≥dulo 3'
        };

        // Estado
        let currentDeck = null;
        let currentCards = [];
        let currentIndex = 0;
        let isFlipped = false;
        let unlockedModules = { m1: false, m2: false, m3: false };

        // Elementos do DOM
        const modulesContainer = document.getElementById('flashcard-modules-container');
        const playArea = document.getElementById('flashcard-play-area');
        const flashcard = document.getElementById('flashcard-active');
        const questionEl = document.getElementById('fc-question');
        const answerEl = document.getElementById('fc-answer');
        const deckTagFront = document.getElementById('fc-deck-tag');
        const deckTagBack = document.getElementById('fc-deck-tag-back');
        const deckNameEl = document.getElementById('fc-deck-name');
        const currentEl = document.getElementById('fc-current');
        const totalEl = document.getElementById('fc-total');
        const progressEl = document.getElementById('fc-progress');
        const prevBtn = document.getElementById('fc-prev');
        const nextBtn = document.getElementById('fc-next');
        const shuffleBtn = document.getElementById('fc-shuffle');
        const backBtn = document.getElementById('fc-back-btn');

        // Verificar elementos
        if (!flashcard || !questionEl || !answerEl) {
            console.error('Flashcard elements not found, retrying...');
            setTimeout(initFlashcards, 100);
            return;
        }

        // Verificar estado de unlock dos m√≥dulos
        function checkUnlockStatus() {
            const badges = JSON.parse(localStorage.getItem('badges') || '{}');

            ['m1', 'm2', 'm3'].forEach(moduleKey => {
                const moduleCard = document.getElementById('fc-module-' + moduleKey);
                if (!moduleCard) return;

                const isUnlocked = badges[moduleKey] && badges[moduleKey].length > 0;
                unlockedModules[moduleKey] = isUnlocked;

                const lockedStatus = moduleCard.querySelector('.locked-status');
                const unlockedStatus = moduleCard.querySelector('.unlocked-status');
                const overlay = moduleCard.querySelector('.fc-module-overlay');

                if (isUnlocked) {
                    moduleCard.classList.remove('locked');
                    moduleCard.classList.add('unlocked');
                    if (lockedStatus) lockedStatus.style.display = 'none';
                    if (unlockedStatus) unlockedStatus.style.display = 'inline';
                    if (overlay) overlay.style.display = 'none';
                    moduleCard.style.cursor = 'pointer';
                } else {
                    moduleCard.classList.add('locked');
                    moduleCard.classList.remove('unlocked');
                    if (lockedStatus) lockedStatus.style.display = 'inline';
                    if (unlockedStatus) unlockedStatus.style.display = 'none';
                    if (overlay) overlay.style.display = 'flex';
                    moduleCard.style.cursor = 'not-allowed';
                }
            });
        }

        function shuffleArray(arr) {
            for (var i = arr.length - 1; i > 0; i--) {
                var j = Math.floor(Math.random() * (i + 1));
                var temp = arr[i];
                arr[i] = arr[j];
                arr[j] = temp;
            }
            return arr;
        }

        function updateUI() {
            var card = currentCards[currentIndex];
            if (!card) return;

            questionEl.textContent = card.q;
            answerEl.textContent = card.a;
            deckTagFront.textContent = card.deck;
            deckTagBack.textContent = card.deck;

            // Re-bind counter elements in case they were lost
            const currentElUpdate = document.getElementById('fc-current');
            const totalElUpdate = document.getElementById('fc-total');

            if (currentElUpdate) currentElUpdate.textContent = currentIndex + 1;
            if (totalElUpdate) totalElUpdate.textContent = currentCards.length;

            if (progressEl) progressEl.style.width = ((currentIndex + 1) / currentCards.length * 100) + '%';

            // Aplicar cor do deck
            flashcard.classList.remove('deck-m1', 'deck-m2', 'deck-m3');
            if (card.deckId) {
                flashcard.classList.add('deck-' + card.deckId);
            }

            prevBtn.disabled = currentIndex === 0;
            nextBtn.disabled = currentIndex === currentCards.length - 1;

            // Reset flip
            if (isFlipped) {
                flashcard.classList.remove('flipped');
                isFlipped = false;
            }
        }

        function selectModule(deckId) {
            if (!unlockedModules[deckId]) {
                if (typeof AudioManager !== 'undefined') AudioManager.playError();
                const moduleCard = document.getElementById('fc-module-' + deckId);
                moduleCard.classList.add('shake');
                setTimeout(() => moduleCard.classList.remove('shake'), 500);
                return;
            }

            if (!flashcardsData[deckId] || flashcardsData[deckId].length === 0) {
                console.error("No cards found for deck " + deckId);
                return;
            }

            currentDeck = deckId;
            currentCards = flashcardsData[deckId].map(c => ({
                q: c.q, a: c.a, deck: deckNames[deckId], deckId: deckId
            }));
            currentIndex = 0;

            deckNameEl.textContent = deckNames[deckId];
            modulesContainer.style.display = 'none';
            playArea.style.display = 'block';
            updateUI();

            if (typeof AudioManager !== 'undefined') AudioManager.playClick();
        }

        function backToModules() {
            playArea.style.display = 'none';
            modulesContainer.style.display = 'grid';
            currentDeck = null;
            if (typeof AudioManager !== 'undefined') AudioManager.playClick();
        }

        // Event Listeners para m√≥dulos
        document.querySelectorAll('.flashcard-module-card').forEach(card => {
            card.addEventListener('click', function () {
                const moduleNum = this.dataset.module;
                selectModule('m' + moduleNum);
            });
        });

        // Event Listeners do flashcard
        flashcard.addEventListener('click', function () {
            flashcard.classList.toggle('flipped');
            isFlipped = !isFlipped;
        });

        prevBtn.addEventListener('click', function () {
            if (currentIndex > 0) {
                currentIndex--;
                updateUI();
            }
        });

        nextBtn.addEventListener('click', function () {
            if (currentIndex < currentCards.length - 1) {
                currentIndex++;
                updateUI();
            }
        });

        shuffleBtn.addEventListener('click', function () {
            shuffleArray(currentCards);
            currentIndex = 0;
            updateUI();
        });

        backBtn.addEventListener('click', backToModules);

        // Inicializar
        checkUnlockStatus();
        console.log('Flashcards initialized successfully!');
    }

    // Tentar inicializar ap√≥s pequeno delay para garantir DOM pronto
    setTimeout(initFlashcards, 50);
</script>

<style>
    /* Grid de m√≥dulos de flashcards */
    .flashcard-modules-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: var(--spacing-lg);
        margin-top: var(--spacing-lg);
    }

    .flashcard-module-card {
        background: var(--bg-secondary);
        border-radius: var(--radius-lg);
        padding: var(--spacing-lg);
        border: 1px solid var(--border-color);
        position: relative;
        overflow: hidden;
        transition: all var(--transition-normal);
    }

    .flashcard-module-card.locked {
        opacity: 0.7;
    }

    .flashcard-module-card.unlocked {
        cursor: pointer;
    }

    .flashcard-module-card.unlocked:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
        border-color: var(--primary-color);
    }

    .fc-module-header {
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
        margin-bottom: var(--spacing-sm);
    }

    .fc-module-icon {
        font-size: 1.5rem;
    }

    .fc-module-header h3 {
        margin: 0;
        font-size: 1.1rem;
        color: var(--text-primary);
        flex: 1;
    }

    .fc-card-count {
        background: var(--primary-color);
        color: white;
        padding: 2px 8px;
        border-radius: var(--radius-full);
        font-size: 0.7rem;
        font-weight: 600;
    }

    .fc-module-desc {
        color: var(--text-secondary);
        font-size: 0.9rem;
        margin: var(--spacing-xs) 0 var(--spacing-md);
    }

    .fc-module-status {
        margin-top: var(--spacing-sm);
    }

    .fc-status {
        font-size: 0.8rem;
        padding: 4px 10px;
        border-radius: var(--radius-full);
    }

    .fc-status.locked-status {
        background: rgba(255, 152, 0, 0.15);
        color: #e65100;
    }

    .fc-status.unlocked-status {
        background: rgba(76, 175, 80, 0.15);
        color: #2e7d32;
    }

    .fc-module-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(255, 255, 255, 0.8);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 5;
        pointer-events: none;
    }

    .fc-module-overlay .lock-icon {
        font-size: 2rem;
        opacity: 0.6;
    }

    .flashcard-module-card.unlocked .fc-module-overlay {
        display: none;
    }

    /* √Årea de jogo */
    .flashcard-deck-header {
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
        margin-bottom: var(--spacing-lg);
        padding-bottom: var(--spacing-md);
        border-bottom: 1px solid var(--border-color);
    }

    .btn-back-to-modules {
        background: transparent;
        border: 1px solid var(--border-color);
        padding: var(--spacing-xs) var(--spacing-md);
        border-radius: var(--radius-md);
        cursor: pointer;
        color: var(--text-secondary);
        transition: all var(--transition-fast);
    }

    .btn-back-to-modules:hover {
        background: var(--bg-secondary);
        color: var(--text-primary);
    }

    .flashcard-deck-name {
        font-weight: 600;
        color: var(--primary-color);
    }

    /* Dark mode */
    body.high-contrast .flashcard-module-card {
        background: var(--bg-secondary);
    }

    body.high-contrast .fc-module-overlay {
        background: rgba(30, 30, 30, 0.9);
    }

    body.high-contrast .fc-status.locked-status {
        background: rgba(255, 152, 0, 0.25);
        color: #ffb74d;
    }

    body.high-contrast .fc-status.unlocked-status {
        background: rgba(76, 175, 80, 0.25);
        color: #81c784;
    }
</style>